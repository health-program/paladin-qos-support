<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.paladin.qos.dynamic.mapper.migration.DataMigrateMapper">

	<select id="selectData" resultType="Map">
		${sql}
	</select>

	<insert id="insertData">
		 INSERT INTO ${tableName}
        <foreach collection="dataMap.keys" item="key" separator="," open="(" close=")">
            ${key}
        </foreach>
        VALUES
        <foreach collection="dataMap.keys" item="key" separator="," open="(" close=")">
            #{dataMap[${key}]}
		</foreach>
	</insert>
	
	<update id="updateData">
		UPDATE ${tableName} SET
		<foreach collection="dataMap.entrySet()" item="value" index="key" separator=",">
			${key}=#{value}
		</foreach>
		<where>
			<foreach collection="primaryMap.entrySet()" item="value" index="key" separator=",">
				AND ${key}=#{value}
			</foreach>
		</where>
	</update>

	<select id="getMaxUpdateTime" resultType="Date">
		SELECT ${updateTimeField} FROM ${tableName} ORDER BY ${updateTimeField} DESC LIMIT 1
	</select>

</mapper>
